(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{IYjq:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Oe}));i("FZtP");var s=i("uOUT"),o=(i("rB9j"),i("4mDm"),i("3bBZ"),i("ToJy"),i("4Brf"),i("E9XD"),i("UxlC"),Backbone.View.extend({tagName:"li",className:"j-filters__element filters__element filters__element-clear",events:{click:"clearAll"},attributes:{tabindex:"0",role:"button","aria-label":"Clear all"},initialize:function(e){return this.isMobile=e.isMobile,this},render:function(){var e=this.isMobile?TPS.messages["redesign.text.facet.clearFilters"]:TPS.messages["text.facet.clearAll"];return this.$el.html(e),this},clearAll:function(e){e.preventDefault(),this.trigger("clear-all")}})),r=i("CS/8");function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var l=Backbone.View.extend({tagName:"ul",className:"filters__group",mobileFilterGroupClass:"filters__group-mobile",hiddenFilterGroupClass:"filters__group-hidden",elementMobileClass:"filters__element-mobile",events:{"click .j-filters__cross":"removeFilter"},initialize:function(e){return this.isMobile=e.isMobile,this.code=e.code,this.overlay=$(".j-overlay"),this.listenTo(this.model,"change",this.update),this},update:function(){this.$el.empty(),this.render()},render:function(){var e=this,t=this.model.get("filters"),i=this.model.get("prices"),s=this.isMobile?this.elementMobileClass:"";if(this.isMobile&&(this.$el.addClass(this.mobileFilterGroupClass),this.$el.addClass(this.hiddenFilterGroupClass)),i&&(!this.isMobile||"priceValue"===this.code)&&this.isShowSliderFilter(i)){var r=i.maxSel,l=i.minSel,a=i.symbolCurrency,c="Price: <span>".concat(a).concat(l,"</span>-<span>").concat(a).concat(r,"</span>"),d=this.getLiElement(c,s,"","priceValue");this.$el.removeClass(this.hiddenFilterGroupClass),this.$el.append(d)}if(!t||"object"!==n(t)||t.constructor!==Object||!Object.keys(t).length)return this;if(Object.keys(t).forEach((function(i){var o=t[i].models;if((!e.isMobile||e.code===i)&&o&&o.length){var r=o.reduce((function(t,i){var o=i.get("code");o&&(o=o.replace(/\s/g,""));var r=i.get("name"),n=i.get("categoryCode");return"".concat(t).concat(e.getLiElement(r,s,n,o))}),"",e);e.$el.removeClass(e.hiddenFilterGroupClass),e.$el.append(r)}})),this.initStarRating(),this.isShowClearAll(t,i)){var h=new o({isMobile:this.isMobile});h.on("clear-all",this.clearAll,this),this.$el.removeClass(this.hiddenFilterGroupClass),this.$el.append(h.render().$el)}return this},removeFilter:function(e){e.preventDefault();var t=this.$(e.currentTarget),i=t.data("code");if("priceValue"===i)return this.trigger("remove-price",this.model.get("prices")),void this.overlay.hide();for(var s=t.data("category"),o=this.model.get("filters")[s],r=0,n=o.length;r<n;r++){var l=o.models[r];if(l.get("code")&&l.get("code").replace(/\s/g,"")==i)return this.trigger("remove-filter",{model:l}),void this.overlay.hide()}},clearAll:function(){this.trigger("clear-all")},isShowSliderFilter:function(e){if(!e)return!1;var t=e.maxSlider,i=e.maxSel,s=e.minSlider,o=e.minSel;return t!==i||s!==o},isShowClearAll:function(e,t){return!this.isMobile||"accordion"===this.code&&(!!Object.keys(e).filter((function(e){return"sort"!==e})).length||this.isShowSliderFilter(t))},initStarRating:function(){$.each(this.$(".j-star_rating"),(function(e,t){new r.a({el:$(t)})}))},getLiElement:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return i&&"feefoAverageRatingRange"===i?"\n            <li class='filters__element ".concat(t,'\' tabindex="0" role="button" aria-label="Delete rate">\n                <span class="filters__name filters__name-rating">\n                    <div class="j-star_rating facets__list_element_rating" data-count=').concat(s[0],"></div><span>").concat("5&up"===s?"":"& up",'</span>\n                </span>\n                <i class="j-filters__cross filters__cross icon_cross-dark" data-category="').concat(i,'" data-code="').concat(s,'"/>\n            </li>'):"\n            <li class='filters__element ".concat(t,'\' tabindex="0" role="button" aria-label="Delete ').concat(e,'">\n                <span class="filters__name">').concat(e,'</span>\n                <i class="j-filters__cross filters__cross icon_cross-dark" data-category="').concat(i,'" data-code="').concat(s,'"/>\n            </li>')}}),a=Backbone.View.extend({className:"filters",mobileFilterClass:"filters-mobile",initialize:function(e){return this.filtersModel=e.filtersModel,this.isMobile=e.isMobile,this.code=e.code,this.views={},this},render:function(){return this.isMobile&&this.$el.addClass(this.mobileFilterClass),this.views.filters=new l({model:this.filtersModel,code:this.code,isMobile:this.isMobile}),this.views.filters.on("remove-filter",this.removeFilter,this),this.views.filters.on("remove-price",this.removePrice,this),this.views.filters.on("clear-all",this.clearAll,this),this.$el.html(this.views.filters.render().$el),this},removeFilter:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-filter"].concat(t))},removePrice:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-price"].concat(t))},clearAll:function(){this.trigger("clear-all")}}),c={SORT_NAME:TPS.messages["redesign.text.facet.sortby"],SORT_CODE:"sort",FILTER_NAME:TPS.messages["redesign.text.facet.filter"],FILTER_CODE:"filter",DEFAULT_VALUES:{MIN_SLIDER:0,MAX_SLIDER:0,CURRENCY:"Â£"},PRICE_VALUE_CODE:"priceValue"},d=Backbone.View.extend({tagName:"a",className:"facets__title j-facets__title Product_Filters_lvl1",selectedFiltersClassName:"facets__title-selected",defaultMinFilterAmount:0,singleFilterAmount:1,attributes:{tabindex:"0","aria-haspopup":"listbox"},events:{click:"toggle",keydown:"toggle"},initialize:function(e){return this.title=e.title,this.isUpdated=e.isUpdated,this.isMobile=e.isMobile,this.filtersModel=e.filtersModel,this.pricesModel=e.pricesModel,void 0!==e.dropdownCode&&(this.el.id=e.dropdownCode),this},render:function(){if(this.model){var e;if(!this.isUpdated||this.isMobile||this.multiSelect)if(this.title===c.FILTER_NAME){var t=this.filtersAmountUpdate()+this.pricesAmountUpdate(),i=t>this.defaultMinFilterAmount?t:0;if(i){var s=i>this.singleFilterAmount?"".concat(i," ").concat(this.title,"s"):"".concat(this.singleFilterAmount," ").concat(this.title);e="".concat(s)}else e="".concat(this.title);this.$el.toggleClass(this.selectedFiltersClassName,!!i)}else e="".concat(this.title);else{var o=this.model.find((function(e){return e.get("selected")})),r=o?o.get("name"):"";e='<span class="j-sort facets__title-sort '.concat(r?"active":"",'">').concat(this.title," </span>").concat(r)}this.$el.html(e)}return this},toggle:function(e){var t=e.key||e.keyCode;"keydown"===e.type&&"Enter"!==t&&13!==t||(e.preventDefault(),this.trigger("toggle-menu",{isKeyPressed:"keydown"===e.type}))},filtersAmountUpdate:function(){var e=this.filtersModel.get("filters"),t=0;return e&&Object.keys(e).forEach((function(i){i!==c.SORT_CODE&&i!==c.PRICE_VALUE_CODE&&(t+=e[i].length)})),t},pricesAmountUpdate:function(){var e=this.filtersModel.get("prices"),t=0;if(e){var i=parseFloat(e.maxSel),s=parseFloat(e.maxSlider),o=parseFloat(e.minSel),r=parseFloat(e.minSlider);i===s&&o===r||(t=1)}return t}}),h=(i("Junv"),Backbone.View.extend({events:{click:"submitBtnClick"},render:function(){return this.$el.append('<button type="submit" class="facets__btn btn btn-black">'.concat(TPS.messages["redesign.text.facet.viewSelection"],"</button>")),this},submitBtnClick:function(){this.trigger("submit-btn-click")}})),u=(i("SYor"),Backbone.View.extend({tagName:"ul",className:"facets__list",attributes:{role:"listbox"},events:{"click li":"itemSelected","keydown li":"handleKeydown"},initialize:function(e){return this.isMobile=e.isMobile,this.listenTo(this.model,"change",this.update),this.listenTo(this.model,"reset",this.update),this},render:function(){var e=this.model&&this.model.reduce((function(e,t){if("feefoAverageRatingRange"===t.get("categoryCode"))return"".concat(e,'\n                    <li class="facets__list_element j-facets__list_element Product_Filters_lvl2').concat(t.get("selected")?" facets__list_element-chosen":"").concat(t.get("isHidden")?" facets__list_element-hidden":"",'"\n                        data-code=').concat(t.get("code")[0],'\n                    >\n                        <div class="j-star_rating facets__list_element_rating" data-count=').concat(t.get("code")[0],"></div><span>").concat("5"===t.get("code")?"":"& up","</span>\n                    </li>\n                ");var i=void 0!==t.get("count")?" (".concat(t.get("count"),")"):"";return"".concat(e,'<li\n                    id="').concat(t.get("categoryCode"),"-").concat(t.get("code"),'"\n                    role="option"\n                    aria-label="').concat(t.get("name"),'"\n                    tabindex="-1"\n                    aria-selected="').concat(t.get("selected"),'"\n                    class="facets__list_element j-facets__list_element Product_Filters_lvl2').concat(t.get("selected")?" facets__list_element-chosen":"").concat(t.get("isHidden")?" facets__list_element-hidden":"",'"\n                    data-code=').concat(t.get("code"),"\n                >").concat(t.get("name").trim()).concat(i,"</li>")}),"",this);return this.$el.append(e),this.initStarRating(),this.isMobile||this.preventPageScroll(),this},update:function(){this.$el.empty(),this.render()},handleKeydown:function(e){var t=e.key||e.keyCode,i="ArrowDown"===t||"Down"===t||40===t,s="ArrowUp"===t||"Up"===t||38===t;if(i||s){e.preventDefault();var o=$(e.target);i?o.next().focus():s&&o.prev().focus()}"Enter"!==t&&13!==t||this.itemSelected(e),"Tab"!==t&&9!==t||this.trigger("toggle-menu")},itemSelected:function(e){e.preventDefault();var t=this.$(e.currentTarget).index(),i=this.model.at(t);return this.trigger("item-selected",{model:i,collection:this.model,isKeyPressed:"keydown"===e.type}),!0},initStarRating:function(){$.each(this.$(".j-star_rating"),(function(e,t){new r.a({el:$(t)})}))},preventPageScroll:function(){var e=this.$(".facets__list");e.on("DOMMouseScroll mousewheel",(function(t){var i=e[0].scrollTop,s=e[0].scrollHeight,o=e.height(),r="DOMMouseScroll"==t.type?-40*t.originalEvent.detail:t.originalEvent.wheelDelta,n=r>0,l=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1};return!n&&-r>s-o-i?(e.scrollTop(s),l()):n&&r>i?(e.scrollTop(0),l()):void 0}))}}));var p=Backbone.View.extend({className:"facets__search",events:{"keyup input":"filterFacets"},initialize:function(e){this.code=e.code},render:function(){var e="";this.model&&void 0!==this.model.get("values")&&(e=this.model.get("values")[this.code]||"");var t='<i class="facets__search_icon icon_search" />\n            <input type="text" name="brand" value="'.concat(e,'" placeholder="SEARCH..." class="facets__search_input j-facets__search_input" autocomplete="off"/>\n        ');return this.$el.append(t),this},filterFacets:function(e){var t=e.target.value;if(this.model)if(this.model.get("values")){var i=this.model.get("values");i[this.code]=t,this.model.set({values:i})}else this.model.set("values",function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},this.code,t));this.trigger("filter-facets",{value:t})}}),f=(i("obg+"),i("3G7n"),Backbone.View.extend({className:"facets__slider",min:c.DEFAULT_VALUES.MIN_SLIDER,max:c.DEFAULT_VALUES.MAX_SLIDER,render:function(){var e=this;if(!this.model)return this;var t=this.model.get("minSlider")||this.min,i=this.model.get("maxSlider")||this.max,s=this.model.get("minSel")||this.min,o=this.model.get("maxSel")||this.max,r=this.model.get("isDisabled"),n=$(this.$el).slider({range:!0,min:t,max:i,values:[s,o],classes:{"ui-slider-handle":"".concat(r&&i!==t?"facets__slider_handle":"")}});return r&&n.slider("disable"),$(this.$el).on("slide",(function(t,i){e.setValues(i.values)})),$(this.$el).on("slidestop",(function(t,i){e.stopSliderCallback(i.values)})),this},stopSliderCallback:function(e){this.trigger("stop-slider-callback",{model:this.model,values:e})},setValues:function(e){e&&this.model.set({minSel:e[0],maxSel:e[1]})}})),g=Backbone.View.extend({tagName:"p",className:"facets__slider_info",min:c.DEFAULT_VALUES.MIN_SLIDER,max:c.DEFAULT_VALUES.MAX_SLIDER,currency:c.DEFAULT_VALUES.CURRENCY,initialize:function(){this.listenTo(this.model,"change",this.update)},update:function(){this.$el.empty(),this.render()},render:function(){if(!this.model)return this;var e=this.model.get("symbolCurrency")||this.currency,t=this.model.get("minSel")||this.min,i=this.model.get("maxSel")||this.max;return this.$el.append("<span>".concat(e).concat(t,"</span>-<span>").concat(e).concat(i,"</span>")),this}}),m=Backbone.View.extend({className:"facets__dropdown_element_container",initialize:function(e){return this.pricesModel=e.pricesModel,this},render:function(){var e=new f({pricesModel:this.pricesModel,model:this.pricesModel});e.on("stop-slider-callback",this.stopSliderCallback,this),this.$el.append(e.render().$el);var t=new g({model:this.pricesModel});return this.$el.append(t.render().$el),this},stopSliderCallback:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["stop-slider-callback"].concat(t))}}),b=Backbone.View.extend({className:"facets__blocker"});function v(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function w(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var S=Backbone.View.extend({className:"facets__dropdown facets__dropdown_arrow-top j-facets__dropdown",attributes:{"aria-hidden":!0},initialize:function(e){var t=this;return this.multiSelect=e.multiSelect,this.type=e.type,this.isMobile=e.isMobile,this.isShowSubmit=e.isShowSubmit,this.filtersModel=e.filtersModel,this.pricesModel=e.pricesModel,this.dropdownStateModel=e.dropdownStateModel,this.searchModel=e.searchModel,this.code=e.code,this.values=e.values,e.facetsInnerElementClass&&this.$el.addClass(e.facetsInnerElementClass),e.facetsDropdownClass&&this.$el.addClass(e.facetsDropdownClass),this.views={},"feefoAverageRatingRange"===this.code?this.collection=new Backbone.Collection(this.values.reverse()):this.collection=new Backbone.Collection(this.values),"tpsMasterBrandCode"===this.code&&this.listenToOnce(Backbone,"engraving-gallery-select-code",(function(e){return t.itemSelectedNoDropdown({model:t.collection.findWhere({code:e}),collection:t.collection,multiSelect:!0})})),this},render:function(){var e=this;if(this.$el.append((new b).$el),"slider"===this.type)this.views.slider=new m({pricesModel:this.pricesModel}),this.views.slider.on("stop-slider-callback",this.stopSliderCallback,this),this.$el.append(this.views.slider.render().$el);else{if("select"===this.type&&(this.views.search=new p({model:this.searchModel,code:this.code}),this.views.search.on("filter-facets",this.filterFacets,this),this.$el.append(this.views.search.render().$el)),this.collection&&this.collection.length&&(this.views.facetList=new u({model:this.collection,isMobile:this.isMobile}),this.views.facetList.on("item-selected",this.itemSelected,this),this.views.facetList.on("toggle-menu",this.toggleMenu,this),this.$el.append(this.views.facetList.render().$el),!this.isMobile)){var t=this.dropdownStateModel.get("itemPosition")||0;setTimeout((function(){e.$(".facets__list").scrollTop(t)}),0)}this.isShowSubmit&&(this.views.button=new h,this.views.button.on("submit-btn-click",this.submitBtnClick,this),this.$el.append(this.views.button.render().$el))}return this},itemSelected:function(e){var t=y({},e);this.setDropdownModelPosition(),this.trigger("item-selected",function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?v(Object(i),!0).forEach((function(t){w(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):v(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({multiSelect:!!this.multiSelect},t))},toggleMenu:function(){this.trigger("toggle-menu")},itemSelectedNoDropdown:function(){this.setDropdownModelPosition();for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["item-selected-no-dropdown"].concat(t))},setDropdownModelPosition:function(){if(!this.isMobile){var e=this.$(".facets__list").scrollTop();this.dropdownStateModel.set("itemPosition",e)}},stopSliderCallback:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["stop-slider-callback"].concat(t))},removeFilter:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-filter"].concat(t))},clearAll:function(){this.trigger("clear-all")},filterFacets:function(e){var t=e.value;this.views.facetList&&(this.values.forEach((function(e){e.isHidden=!(e.name.toUpperCase().indexOf(t.toUpperCase())>-1)})),this.collection.reset(this.values),this.trigger("filter-facets",{collection:this.collection}))},submitBtnClick:function(){this.trigger("submit-btn-click")}}),M=Backbone.View.extend({className:"facets__accordion_header",events:{click:"toggle"},initialize:function(e){return this.title=e.title,void 0!==e.accordionElementCode&&(this.el.id=e.accordionElementCode),this},render:function(){if(this.title){var e='<div class="facets__accordion_title"><button class="facets__accordion_title_btn">'.concat(this.title,'</button></div><i class="icon icon_arrow-right rotate" />');this.$el.html(e)}return this},toggle:function(e){e.preventDefault(),this.trigger("toggle-accordion")}}),C=Backbone.View.extend({className:"facets__accordion_body",dropdownList:null,initialize:function(e){return this.type=e.type,this.isUpdated=e.isUpdated,this.multiSelect=e.multiSelect,this.values=e.values,this.isMobile=e.isMobile,this.facetsInnerElementClass=e.facetsInnerElementClass,this.pricesModel=e.pricesModel,this.dropdownStateModel=e.dropdownStateModel,this.searchModel=e.searchModel,this.accordionElementCode=e.accordionElementCode,this.listModel=e.listModel,this},render:function(){var e=new S({multiSelect:"feefoAverageRatingRange"!==this.accordionElementCode&&this.multiSelect,values:this.values,type:this.type,isMobile:this.isMobile,isShowSubmit:!1,facetsInnerElementClass:this.facetsInnerElementClass,pricesModel:this.pricesModel,dropdownStateModel:this.dropdownStateModel,searchModel:this.searchModel,code:this.accordionElementCode,listModel:this.listModel});return e.on("item-selected",this.itemSelected,this),e.on("item-selected-no-dropdown",this.itemSelectedNoDropdown,this),e.on("stop-slider-callback",this.stopSliderCallback,this),e.on("filter-facets",this.filterFacets,this),this.$el.append(e.render().$el),this},itemSelected:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["item-selected"].concat(t))},itemSelectedNoDropdown:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["item-selected-no-dropdown"].concat(t))},stopSliderCallback:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["stop-slider-callback"].concat(t))},filterFacets:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["filter-facets"].concat(t))}});function P(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function O(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?P(Object(i),!0).forEach((function(t){k(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):P(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function k(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var E=Backbone.View.extend({className:"facets__accordion",openedClass:"facets__accordion_header-opened",initialize:function(e){return this.title=e.title||"Title",this.values=e.values||[],this.multiSelect=e.multiSelect,this.isUpdated=e.isUpdated,this.isMobile=e.isMobile,this.type=e.type||"text",this.pricesModel=e.pricesModel,this.facetsInnerElementClass=e.facetsInnerElementClass,this.dropdownStateModel=e.dropdownStateModel,this.accordionElementCode=e.accordionElementCode,this.searchModel=e.searchModel,this.listModel=e.listModel,this.filtersModel=e.filtersModel,this.views={},this.collection=new Backbone.Collection(this.values),this},render:function(){return this.views.header=new M({title:this.title,accordionElementCode:this.accordionElementCode}),this.views.header.on("toggle-accordion",this.toggleAccordion,this),this.views.body=new C({multiSelect:this.multiSelect,isUpdated:this.isUpdated,values:this.values,type:this.type,isMobile:this.isMobile,facetsInnerElementClass:this.facetsInnerElementClass,pricesModel:this.pricesModel,dropdownStateModel:this.dropdownStateModel,searchModel:this.searchModel,accordionElementCode:this.accordionElementCode,listModel:this.listModel}),this.views.body.on("item-selected",this.itemSelected,this),this.views.body.on("item-selected-no-dropdown",this.itemSelectedNoAccordion,this),this.views.body.on("stop-slider-callback",this.stopSliderCallback,this),this.views.body.on("filter-facets",this.filterFacets,this),this.views.filters=new a({filtersModel:this.filtersModel,code:this.accordionElementCode,isMobile:this.isMobile}),this.views.filters.on("remove-filter",this.removeFilter,this),this.views.filters.on("remove-price",this.removePrice,this),this.views.filters.on("clear-all",this.clearAll,this),this.$el.append(this.views.header.render().$el),this.$el.append(this.views.body.render().$el),this.$el.append(this.views.filters.render().$el),this},itemSelected:function(e){var t=A({},e),i=this.accordionElementCode;this.trigger("item-selected",O(O({},t),{},{openedAccordionElementCode:i}))},itemSelectedNoAccordion:function(e){var t=A({},e);this.trigger("item-selected-no-dropdown",O({},t))},stopSliderCallback:function(e){var t=A({},e),i=this.accordionElementCode;this.trigger("stop-slider-callback",O({openedAccordionElementCode:i},t))},toggleAccordion:function(){var e=this.views.header.$el,t=this.views.body.$el,i=this.views.filters.$el,s="none"===t.css("display");s?(i.hide(),t.show()):(i.show(),t.hide()),this.changeHeaderElement(e);var o=this.accordionElementCode;this.trigger("toggle-accordion",{header:e,body:t,accordion:this.$el,collection:this.collection,openedAccordionElementCode:o,isHidden:s})},changeHeaderElement:function(e){e.find("i").toggleClass("rotate-clockwise"),e.find("i").toggleClass("icon_arrow-right"),e.find("i").toggleClass("icon_cross-dark"),e.toggleClass(this.openedClass)},filterFacets:function(e){var t=e.collection;this.collection=t,this.views.body.$el.show()},removeFilter:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-filter"].concat(t))},removePrice:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-price"].concat(t))},clearAll:function(){this.trigger("clear-all")}}),j=Backbone.View.extend({className:"facets__subtitle",events:{click:"handleSubtitleClick"},initialize:function(e){this.title=e.title,this.onSubtitleClick=e.onSubtitleClick},render:function(){var e='<p class="facets__subtitle_text">'.concat(this.title,'</p><i class="icon rotate rotate-clockwise icon_cross-dark facets__icon-cross"></i>');return this.$el.append(e),this},handleSubtitleClick:function(){this.trigger("click-subtitle")},toggleSubtitle:function(){this.$el.toggle()}}),D=["accordion","isHidden"];function T(e,t){if(null==e)return{};var i,s,o=function(e,t){if(null==e)return{};var i,s,o={},r=Object.keys(e);for(s=0;s<r.length;s++)i=r[s],t.indexOf(i)>=0||(o[i]=e[i]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)i=r[s],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}function x(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function B(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?x(Object(i),!0).forEach((function(t){F(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function F(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var N=Backbone.View.extend({className:"facets__dropdown facets__dropdown_arrow-top facets_mobile__dropdown",initialize:function(e){return this.facetsInnerElementClass=e.facetsInnerElementClass,this.title=e.title,this.dropdownCode=e.dropdownCode,this.values=e.values,this.isMobile=e.isMobile,this.filtersModel=e.filtersModel,this.pricesModel=e.pricesModel,this.dropdownStateModel=e.dropdownStateModel,this.searchModel=e.searchModel,this.listModel=e.listModel,this.views={},this.subtitle=null,this},render:function(){var e=this;this.$el.append((new b).$el),this.isMobile&&this.title===c.FILTER_NAME&&(this.subtitle=new j({title:this.title}).render(),this.subtitle.on("click-subtitle",this.handleSubtitleClick,this),this.$el.append(this.subtitle.el));this.$el.append('<div class="facets__accordion_container j-facets__accordion_container"></div>');var t=this.$(".j-facets__accordion_container");return this.values.forEach((function(i){var s=new E({model:e.model,values:i.values,title:i.name,isUpdated:i.isUpdated,multiSelect:i.multiSelect,type:i.type,accordionElementCode:i.code,isMobile:e.isMobile,facetsInnerElementClass:e.facetsInnerElementClass,pricesModel:e.pricesModel,dropdownStateModel:e.dropdownStateModel,searchModel:e.searchModel,listModel:e.listModel,filtersModel:e.filtersModel}).render();return s.on("item-selected",e.itemSelected,e),s.on("item-selected-no-dropdown",e.itemSelectedNoDropdown,e),s.on("toggle-accordion",e.toggleAccordion,e),s.on("stop-slider-callback",e.stopSliderCallback,e),s.on("remove-filter",e.removeFilter,e),s.on("remove-price",e.removePrice,e),s.on("clear-all",e.clearAll,e),t.append(s.el),e.$el}),this),this.views.filters=new a({filtersModel:this.filtersModel,isMobile:this.isMobile,code:"accordion"}),this.views.filters.on("clear-all",this.clearAll,this),this.$el.append(this.views.filters.render().$el),this.views.button=new h,this.views.button.on("submit-btn-click",this.submitBtnClick,this),this.$el.append(this.views.button.render().$el),this},itemSelected:function(e){var t=U({},e);this.trigger("item-selected",B({},t))},itemSelectedNoDropdown:function(e){var t=U({},e);this.trigger("item-selected-no-dropdown",B({},t))},stopSliderCallback:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["stop-slider-callback"].concat(t))},toggleAccordion:function(e){var t=e.accordion,i=e.isHidden,s=T(e,D);this.$el.find(".facets__accordion").not(t).each((function(){i?$(this).hide():$(this).show()}));var o=this.views.filters.$el;i?o.hide():o.show(),this.subtitle&&this.subtitle.toggleSubtitle(),this.trigger("toggle-accordion",B({accordion:t,isHidden:i},s))},handleSubtitleClick:function(){this.trigger("toggle-menu")},removeFilter:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-filter"].concat(t))},removePrice:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-price"].concat(t))},clearAll:function(){this.trigger("clear-all")},submitBtnClick:function(){this.trigger("submit-btn-click"),this.trigger("toggle-menu")}});function L(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function R(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?L(Object(i),!0).forEach((function(t){I(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):L(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function I(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var z=Backbone.View.extend({className:"facets__element",views:null,facetTitleActiveClass:"facets__title-active",initialize:function(e){return this.title=e.title,this.type=e.type,this.isUpdated=e.isUpdated||!1,this.multiSelect=e.multiSelect||!1,this.values=e.values||[],this.isMobile=e.isMobile||!1,this.isAccordion=e.isAccordion||!1,this.facetsInnerElementClass=e.facetsInnerElementClass,this.facetsDropdownClass=e.facetsDropdownClass,this.filtersModel=e.filtersModel,this.pricesModel=e.pricesModel,this.dropdownStateModel=e.dropdownStateModel,this.dropdownCode=e.dropdownCode,this.searchModel=e.searchModel,this.listModel=e.listModel,e.facetsElementClass&&this.$el.addClass(e.facetsElementClass),this.views={},this},render:function(){return this.views.title=new d({title:this.title,model:new Backbone.Collection(this.values),isUpdated:this.isUpdated,isMobile:this.isMobile,multiSelect:this.multiSelect,filtersModel:this.filtersModel,pricesModel:this.pricesModel,dropdownCode:this.dropdownCode}),this.views.title.on("toggle-menu",this.toggleMenu,this),this.isAccordion?(this.views.list=new N({model:this.model,title:this.title,values:this.values,facetsInnerElementClass:this.facetsInnerElementClass,isMobile:this.isMobile,filtersModel:this.filtersModel,pricesModel:this.pricesModel,dropdownStateModel:this.dropdownStateModel,searchModel:this.searchModel,listModel:this.listModel}),this.views.list.on("toggle-accordion",this.toggleAccordion,this)):this.views.list=new S({multiSelect:this.multiSelect,values:this.values,type:this.type,isMobile:this.isMobile,isShowSubmit:this.isMobile,facetsDropdownClass:this.isMobile?this.facetsDropdownClass:"",filtersModel:this.filtersModel,pricesModel:this.pricesModel,dropdownStateModel:this.dropdownStateModel,searchModel:this.searchModel,code:this.dropdownCode,listModel:this.listModel}),this.views.list.on("item-selected",this.itemSelected,this),this.views.list.on("item-selected-no-dropdown",this.itemSelectedNoDropdown,this),this.views.list.on("remove-filter",this.removeFilter,this),this.views.list.on("remove-price",this.removePrice,this),this.views.list.on("clear-all",this.clearAll,this),this.views.list.on("submit-btn-click",this.submitBtnClick,this),this.views.list.on("stop-slider-callback",this.stopSliderCallback,this),this.views.list.on("toggle-menu",this.toggleMenu,this),this.$el.append(this.views.title.render().$el),this.$el.append(this.views.list.render().$el),!this.dropdownStateModel.get("openedDropdownCode")||this.dropdownStateModel.get("openedDropdownCode")!==this.dropdownCode||"sort"===this.dropdownStateModel.get("openedDropdownCode")||this.dropdownStateModel.get("clickOnBtn")?(this.views.list.$el.hide(),this.dropdownStateModel.get("clickOnBtn")&&this.dropdownStateModel.set("clickOnBtn",!1)):(this.views.title.$el.addClass(this.facetTitleActiveClass),this.isMobile?this.views.list.$el.css(this.dropdownStateModel.get("mobileDropdownPosition")):this.views.list.$el.css(this.dropdownStateModel.get("desktopDropdownPosition"))),this},itemSelected:function(e){var t=V({},e),i=this.dropdownCode;this.trigger("item-selected",R({dropdownCode:i},t)),this.multiSelect||this.isMobile||this.toggleMenu()},itemSelectedNoDropdown:function(e){var t=V({},e);this.trigger("item-selected",R({},t))},stopSliderCallback:function(e){var t=V({},e),i=this.dropdownCode;this.trigger("stop-slider-callback",R({dropdownCode:i},t))},toggleMenu:function(e){var t=V({},e),i=this.getComponents(),s=i.title,o=i.list,r=this.dropdownCode;this.trigger("toggle-menu",R({title:s,list:o,dropdownCode:r},t))},getComponents:function(){return{title:this.views.title.$el,list:this.views.list.$el}},toggleAccordion:function(e){var t=V({},e),i=this.dropdownCode;this.trigger("toggle-accordion",R({dropdownCode:i},t))},removeFilter:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-filter"].concat(t))},removePrice:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-price"].concat(t))},clearAll:function(){this.trigger("clear-all")},submitBtnClick:function(){this.trigger("submit-btn-click")}}),G=Backbone.View.extend({className:"facets__content facets_mobile__content",facetTitleActiveClass:"facets__title-active",filterToRemove:null,initialize:function(e){this.pricesModel=e.pricesModel,this.filtersModel=e.filtersModel,this.dropdownStateModel=e.dropdownStateModel,this.searchModel=e.searchModel,this.listModel=e.listModel,this.listenTo(this.model,"change:fields",this.update)},update:function(){this.$el.empty(),this.render()},render:function(){var e=this;if(this.model){var t=this.model.get("fields");t&&t.forEach((function(t){var i=new z({model:e.model,values:t.values,title:t.name,isUpdated:t.isUpdated,multiSelect:t.multiSelect,type:t.type,isAccordion:t.isAccordion,dropdownCode:t.code,isMobile:!0,isShowSubmit:!0,facetsElementClass:"facets_mobile__element",facetsDropdownClass:"facets_mobile__dropdown",facetsInnerElementClass:"facets_mobile__element-inner",filtersModel:e.filtersModel,pricesModel:e.pricesModel,dropdownStateModel:e.dropdownStateModel,searchModel:e.searchModel,listModel:e.listModel}).render();return i.on("item-selected",e.itemSelected,e),i.on("toggle-menu",e.toggleMenu,e),i.on("toggle-accordion",e.toggleAccordion,e),i.on("submit-btn-click",e.submitBtnClick,e),i.on("remove-filter",e.removeFilter,e),i.on("remove-price",e.removePrice,e),i.on("clear-all",e.clearAll,e),i.on("stop-slider-callback",e.stopSliderCallback,e),e.$el.append(i.el),e.$el}),this)}return this},itemSelected:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["item-selected"].concat(t))},toggleAccordion:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["toggle-accordion"].concat(t))},removeFilter:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-filter"].concat(t))},removePrice:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-price"].concat(t))},submitBtnClick:function(){this.trigger("submit-btn-click")},clearAll:function(){this.trigger("clear-all")},stopSliderCallback:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["stop-slider-callback"].concat(t))},toggleMenu:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["toggle-menu"].concat(t))}});function H(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function q(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?H(Object(i),!0).forEach((function(t){W(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):H(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function W(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Q(){return(Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var K=Backbone.View.extend({className:"facets__content",fields:new Backbone.Collection([]),initialize:function(e){this.pricesModel=e.pricesModel,this.dropdownStateModel=e.dropdownStateModel,this.searchModel=e.searchModel,this.listModel=e.listModel,this.listenTo(this.model,"change:fields",this.update)},update:function(){this.$el.empty(),this.render()},render:function(){var e=this;if(this.model){var t=this.model.get("fields");t&&t.forEach((function(t){var i=new z({model:e.model,values:t.values,title:t.name,isUpdated:t.isUpdated,multiSelect:"feefoAverageRatingRange"!==t.code&&t.multiSelect,type:t.type,dropdownCode:t.code,pricesModel:e.pricesModel,dropdownStateModel:e.dropdownStateModel,searchModel:e.searchModel,listModel:e.listModel}).render();i.on("item-selected",e.itemSelected,e),i.on("toggle-menu",e.toggleMenu,e),i.on("stop-slider-callback",e.stopSliderCallback,e),e.$el.append(i.el);var s=e.model.get("focusedElementId");return null!=s&&Backbone.trigger("setFocus",{id:s}),e.$el}),this)}return this},itemSelected:function(e){var t=Q({},e);this.trigger("item-selected",q({},t))},toggleMenu:function(e){var t=Q({},e);this.trigger("toggle-menu",q({},t))},stopSliderCallback:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["stop-slider-callback"].concat(t))}}),J=i("hsyc");function X(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function Z(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Y(){return(Y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var ee=Backbone.View.extend({facets:{},facetTitleActiveClass:"facets__title-active",facetsListElementClass:"j-facets__list_element",filterMobileElementClass:"j-filters__element",filterCrossElementClass:"j-filters__cross",accordionContainerClass:"j-facets__accordion_container",sortTitleClass:"j-sort",activeTitle:null,activeList:null,dropdownCode:null,initialize:function(e){return this.isMobile=e.isMobile,this.filtersModel=e.filtersModel,this.pricesModel=e.pricesModel,this.dropdownStateModel=e.dropdownStateModel,this.searchModel=e.searchModel,this.listModel=e.listModel,this.overlay=$(".j-overlay"),J.a.on("click",this.hideDropdownList.bind(this)),this},render:function(){return this.isMobile?this.facets=new G({model:this.model,filtersModel:this.filtersModel,pricesModel:this.pricesModel,dropdownStateModel:this.dropdownStateModel,searchModel:this.searchModel,listModel:this.listModel}).render():this.facets=new K({model:this.model,pricesModel:this.pricesModel,dropdownStateModel:this.dropdownStateModel,searchModel:this.searchModel,listModel:this.listModel}).render(),this.facets.on("item-selected",this.itemSelected,this),this.facets.on("remove-filter",this.removeFilter,this),this.facets.on("remove-price",this.removePrice,this),this.facets.on("clear-all",this.clearAll,this),this.facets.on("stop-slider-callback",this.stopSliderCallback,this),this.facets.on("toggle-accordion",this.toggleAccordion,this),this.facets.on("submit-btn-click",this.submitBtnClick,this),this.facets.on("toggle-menu",this.toggleMenu,this),this.$el.append(this.facets.$el),this},itemSelected:function(e){var t=Y({},e);this.trigger("item-selected",function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?X(Object(i),!0).forEach((function(t){Z(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):X(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},t))},toggleAccordion:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["toggle-accordion"].concat(t))},toggleMenu:function(e){var t=e.title,i=e.list,s=e.dropdownCode,o=e.isKeyPressed,r=this.$el.find(".facets__element");r.children(".facets__title").not(t).removeClass(this.facetTitleActiveClass),t.toggleClass(this.facetTitleActiveClass),this.activeTitle=t.hasClass(this.facetTitleActiveClass)?t:null,this.activeList=t.hasClass(this.facetTitleActiveClass)?i:null,this.dropdownCode=t.hasClass(this.facetTitleActiveClass)?s:void 0,r.children(".facets__dropdown").not(i).hide(),this.isMobile?(this.setDropdownTopPosition(i),this.toggleOverlay()):i.is(":hidden")&&this.setDropdownPositions(t,i),i.toggle(),i.attr({"aria-hidden":!i.attr("aria-hidden")}),o&&i.is(":visible")&&i.find(".j-facets__list_element").first().focus(),this.trigger("toggle-menu",{title:this.activeTitle,list:this.activeList,dropdownCode:this.dropdownCode})},setDropdownTopPosition:function(e){var t=this.$el.outerHeight()+"px";this.dropdownStateModel.set("mobileDropdownPosition",{top:t}),e.css({top:t})},setDropdownPositions:function(e,t){var i=this.getDropdownPositions(e,t),s=i.top,o=i.left,r=i.bottom,n=i.right;this.dropdownStateModel.set("desktopDropdownPosition",{top:s,left:o,bottom:r,right:n}),t.css({top:s,left:o,right:n,bottom:r})},getDropdownPositions:function(e,t){var i=this.$el.find(".facets__element"),s=i.position(),o=i.outerHeight(),r=s.top+o+"px",n=e.width(),l=n/2,a=t.outerWidth(),c=a/2,d=e.offset().left-this.$el.offset().left,h=d+l,u=this.$el.offset().left+this.$el.innerWidth()-(e.offset().left+n),p="auto";if(h<c)p=-d+"px";else if(u+l<c)p=-(a-(u+n))+"px";else{p=-c+l+"px"}return{top:r,left:p,bottom:"auto",right:"auto"}},hideDropdownList:function(e){J.a.off("click",this.hideDropdownList.bind(this));var t=$(e.target),i=$(".".concat(this.facetTitleActiveClass));t.parents().filter(".j-facets__dropdown:visible").length||t.hasClass("j-facets__dropdown")||t.hasClass("facets__title")||t.hasClass(this.facetsListElementClass)||t.hasClass(this.sortTitleClass)||this.isMobile&&(t.hasClass(this.filterMobileElementClass)||t.hasClass(this.filterCrossElementClass)||t.closest(".".concat(this.accordionContainerClass)).length)||(this.activeTitle?this.toggleMenu({title:this.activeTitle,list:this.activeList,dropdownCode:this.dropdownCode}):i.length&&this.toggleMenu({title:i,list:i.next(),dropdownCode:this.dropdownCode}))},toggleOverlay:function(){this.overlay.length&&(this.activeTitle?this.overlay.show():this.overlay.hide())},submitBtnClick:function(){this.trigger("submit-btn-click"),this.overlay.hide()},removeFilter:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-filter"].concat(t))},removePrice:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["remove-price"].concat(t))},clearAll:function(){this.trigger("clear-all"),this.isMobile&&this.overlay.hide()},stopSliderCallback:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.trigger.apply(this,["stop-slider-callback"].concat(t))}}),te=i("WQFK"),ie={code:c.FILTER_CODE,name:c.FILTER_NAME,type:"text",isAccordion:!0,values:[]},se={code:c.SORT_CODE,name:c.SORT_NAME,isUpdated:!0,values:[]},oe=function(){function e(e){var i=e.isMobile,s=e.sort,o=e.facets;return i?function(e){var i=e.sort,s=e.facets,o=[];if(Array.isArray(s)){var r=[];s.forEach((function(e){t(e),r.push(e)})),ie.values=r,o.push(ie)}Array.isArray(i)&&(i.forEach((function(e){e.categoryCode=c.SORT_CODE})),se.values=i,t(se),o.unshift(se));return o}({sort:s,facets:o}):function(e){var i=e.sort,s=e.facets,o=[];Array.isArray(s)&&s.forEach((function(e){t(e),o.push(e)}));Array.isArray(i)&&(i.forEach((function(e){e.categoryCode=c.SORT_CODE})),se.values=i,t(se),o.unshift(se));return o}({sort:s,facets:o})}function t(e){e&&(e.type=function(e){switch(e){case"masterBrandName":case"productType":case"tpsMasterBrandCode":case"igcRangeNameCode":return"select";case"priceValue":return"slider";default:return"text"}}(e.code),e.values&&e.values.forEach((function(t){t.categoryCode=e.code})))}return{getFacetsData:function(t){return e({isMobile:t.isMobile,sort:t.sort,facets:t.facets})},getFiltersData:function(e){return function(e){var t=e.sort,i=e.facets,s={};if(Array.isArray(t)&&t.length){var o=t.filter((function(e){return e.selected}));o.length&&(s[c.SORT_CODE]=o)}return Array.isArray(i)&&i.forEach((function(e){var t=e.values;if(t.length){var i=t.filter((function(e){return e.selected}));i.length&&(s[e.code]=i)}})),s}({sort:e.sort,facets:e.facets})}}}();function re(e){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function le(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(i),!0).forEach((function(t){ae(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ne(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function ae(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ce=Backbone.View.extend({facetsRequestParams:{},sortRequestParams:{},params:"",classes:{stickyClass:"facets-sticky",hiddenClass:"facets-hidden",hideHeaderClass:"hide"},initialize:function(e){var t=this;TPS.pageData.isFacetsInitialized=!0,this.prices=e.prices||{},this.userPrices=null,this.pricesModel=new Backbone.Model(le(le({},this.prices),{},{isDisabled:this.prices.maxSlider===this.prices.minSlider})),this.isMobile=e.isMobile||!1,this.sortOptions=e.sorts||[];var i=oe.getFacetsData({isMobile:this.isMobile,sort:this.sortOptions,facets:e.facets});if(this.facetsModel=new Backbone.Model({fields:i}),this.filters=this.getFilters(this.sortOptions,e.facets),this.filtersModel=new Backbone.Model({filters:this.filters,prices:this.prices}),this.views={},this.isPriceUpdating=!1,this.dropdownStateModel=new Backbone.Model({openedDropdownCode:void 0,openedAccordionElementCode:void 0,clickOnBtn:!1}),this.searchModel=new Backbone.Model,this.listModel=new Backbone.Model,this.elements={productGrid:$(".j-product_grid"),body:J.a,header:J.c},J.f.scrollTop()>this.elements.productGrid.position().top){this.$el.addClass(this.classes.stickyClass);var s=Object(J.g)()+"px";this.$el.css({top:s})}if(this.listenTo(Backbone,"change:headerVisibility",_.throttle(this.handleHeaderCollapse.bind(this),200)),document.addEventListener("scroll",_.throttle(this.handleScrollPage.bind(this),50),te.a),this.searchValues={},window.location.search.length){this.searchValues=TPS.utils.facetSearchQueryToObj(window.location.search);var o=this.searchValues.q;if(o&&o.indexOf("priceValue")>-1){var r=o.indexOf("priceValue")+"priceValue".length+1,n=o.substr(r).match(/\d+/g).map(Number);this.userPrices||(this.userPrices={}),this.userPrices.minSel=n[0],this.userPrices.maxSel=n[1]}}return window.history&&window.history.pushState&&(this.handlePopstate=this.handlePopstate.bind(this),window.addEventListener("popstate",this.handlePopstate,!0)),Backbone.on("engraving-gallery-select-code",(function(){t.isEngravingGallery=!0,setTimeout((function(){t.isEngravingGallery=!1}))})),this.$el.empty(),Backbone.on("setFocus",this.setFocus,this),this},render:function(){if(this.el)return this.$el.append((new b).$el),this.views.facets=new ee({model:this.facetsModel,isMobile:this.isMobile,filtersModel:this.filtersModel,pricesModel:this.pricesModel,dropdownStateModel:this.dropdownStateModel,searchModel:this.searchModel,listModel:this.listModel}),this.views.facets.on("item-selected",this.itemSelected,this),this.views.facets.on("toggle-accordion",this.toggleAccordion,this),this.views.facets.on("remove-filter",this.removeFilter,this),this.views.facets.on("remove-price",this.removePrice,this),this.views.facets.on("clear-all",this.clearAll,this),this.views.facets.on("stop-slider-callback",this.stopSliderCallback,this),this.views.facets.on("submit-btn-click",this.submitBtnClick,this),this.views.facets.on("toggle-menu",this.toggleMenu,this),this.$el.append(this.views.facets.render().$el),this.isMobile||(this.views.filters=new a({filtersModel:this.filtersModel}),this.views.filters.on("remove-filter",this.removeFilter,this),this.views.filters.on("remove-price",this.removePrice,this),this.views.filters.on("clear-all",this.clearAll,this),this.$el.append(this.views.filters.render().$el)),this},handlePopstate:function(){TPS.pageData.popupOpened>0?TPS.pageData.popupOpened-=1:(this.searchValues=TPS.utils.facetSearchQueryToObj(window.location.search),this.getFilteredData(null,void 0,void 0,!0))},getFilters:function(e,t){var i=oe.getFiltersData({sort:e,facets:t}),s={};return 0!==Object.keys(i).length&&i.constructor===Object&&Object.keys(i).forEach((function(e){s[e]=new Backbone.Collection(i[e])})),s},handleScrollPage:function(){var e=Object(J.g)();if(J.f.scrollTop()+e>this.elements.productGrid.offset().top){this.$el.addClass(this.classes.stickyClass);var t=this.isMobile?0:e;this.$el.css({top:t})}else this.$el.css("top",""),this.$el.removeClass(this.classes.hiddenClass),this.$el.removeClass(this.classes.stickyClass)},handleHeaderCollapse:function(e,t){this.$el.hasClass(this.classes.stickyClass)&&this.$el.css("top",e?t:"")},setOpenedDropdownCodes:function(e,t){this.dropdownStateModel.set("openedDropdownCode",e),this.dropdownStateModel.set("openedAccordionElementCode",t)},itemSelected:function(e){var t=e.model,i=e.multiSelect,s=e.collection,o=e.dropdownCode,r=e.openedAccordionElementCode,n=e.isKeyPressed,l=t&&t.get("categoryCode");if(l){var a=void 0!==t.get("selected")&&t.get("selected");t.set("selected",!a),!i&&s&&s.length?this.resetFilterValue(t,l,!a,s):this.toggleFilters(t,l,!a),l===c.SORT_CODE&&this.sortOptions.length&&this.sortOptions.forEach((function(e){e.selected=t.get("code")===e.code})),this.setParams(this.filters),!this.isEngravingGallery&&this.isMobile||this.getFilteredData(s,o,r),this.filtersModel.unset("filters"),this.filtersModel.set("filters",this.filters),this.setOpenedDropdownCodes(o,r),n?this.focusedElementId=i?"".concat(l,"-").concat(t.get("code")):l:this.focusedElementId&&(this.focusedElementId=null)}},setFocus:function(e){var t=e.id;$("#".concat(t)).focus()},toggleAccordion:function(e){var t=e.isHidden,i=e.collection,s=e.dropdownCode,o=e.openedAccordionElementCode;this.dropdownStateModel.set("clickOnBtn",!!t),this.setOpenedDropdownCodes(s,o),t||this.getFilteredData(i,s,o)},toggleMenu:function(e){var t=e.dropdownCode;this.dropdownStateModel.set("openedDropdownCode",t),this.$el.toggleClass("facets-open",!!t)},submitBtnClick:function(){this.dropdownStateModel.set("clickOnBtn",!0),this.getFilteredData(),this.searchModel.clear()},stopSliderCallback:function(e){var t=e.model,i=e.dropdownCode,s=e.openedAccordionElementCode;this.prices=le({},t.attributes),!this.isPriceUpdating&&t&&(this.filters[c.PRICE_VALUE_CODE]=t,this.userPrices=le({},t.attributes),this.setParams(this.filters),this.isMobile||this.getFilteredData()),this.filtersModel.unset("prices"),this.filtersModel.set("prices",this.prices),this.setOpenedDropdownCodes(i,s)},toggleFilters:function(e,t,i){this.filters[t]||(this.filters[t]=new Backbone.Collection([]));var s=!1;if(i){for(var o=0,r=this.filters[t].length;o<r;o++){if(this.filters[t].models[o].get("code")===e.get("code"))return void(s=!0)}s||this.filters[t].add(e)}else this.removeModel(e,t),s=!0;var n=this.correctModel(e,t);n&&n.set("selected",!s)},correctModel:function(e,t){var i=this.listModel.get(t);if(!i)return null;for(var s=0,o=i.length;s<o;s++){var r=i.models[s];if(r.get("code")===e.get("code"))return r}return null},resetFilterValue:function(e,t,i,s){this.filters[t]||(this.filters[t]=new Backbone.Collection([])),this.filters[t].reset(),i&&this.filters[t].add(e),s.forEach((function(t){var s=!1;t===e&&(s=i),t.set("selected",s)}))},removeFilter:function(e){var t=e.model,i=t&&t.get("categoryCode");i&&(i&&this.filters[i]&&(this.removeModel(t,i),i===c.SORT_CODE&&this.sortOptions.forEach((function(e){e.selected=!1})),this.filtersModel.unset("filters"),this.filtersModel.set("filters",this.filters)),this.setParams(this.filters),this.getFilteredData(),this.isMobile||this.dropdownStateModel.set("openedDropdownCode",void 0))},removePrice:function(){this.userPrices=null,this.filtersModel.unset("prices"),this.resetPrice(),delete this.filters[c.PRICE_VALUE_CODE],this.setParams(this.filters),this.getFilteredData()},removeModel:function(e,t){for(var i=0,s=this.filters[t].length;i<s;i++){var o=this.filters[t].models[i];if(o.get("code")===e.get("code"))return this.filters[t].remove(o),void(this.filters[t].length||delete this.filters[t])}},clearAll:function(){var e=this;Object.keys(this.filters).forEach((function(t){var i=e.filters[t];t===c.PRICE_VALUE_CODE?e.resetPrice():i&&i.length&&i.forEach((function(e){e.set("selected",!1)})),t===c.SORT_CODE&&e.sortOptions.forEach((function(e){e.selected=!1}))})),this.filters={},this.userPrices=null,this.filtersModel.unset("filters"),this.filtersModel.unset("prices"),this.filtersModel.set("filters",this.filters),this.setParams(this.filters),this.getFilteredData(),this.isMobile||this.dropdownStateModel.set("openedDropdownCode",void 0)},resetPrice:function(){this.isPriceUpdating=!0,this.pricesModel.set("minSel",this.pricesModel.get("minSlider")),this.pricesModel.set("maxSel",this.pricesModel.get("maxSlider"))},getFilteredData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.$el.closest(".facets"),n=this;r.addClass("disable"),this.model.set({isFilter:!0}),this.params=TPS.utils.objToSearchQuery(this.searchValues),this.model.fetch({data:"".concat(this.params.slice(1)),complete:function(e){n.model.set({status:e.status,isFilter:!1}),n.isPriceUpdating=!1,r.removeClass("disable")}}).then((function(r){var n=decodeURIComponent(window.location.search);n.includes("::")&&n.includes(":")&&((n=n.split("::")[1]).includes("&")&&(n=n.split("&")[0]),e.sendGtmEventForSearchUpdate(n.split(":")));var l=r.priceSlider;if(l){var a=e.pricesModel.get("symbolCurrency"),c=Math.ceil(l.maxSel),d=Math.floor(l.minSel),h=Math.ceil(l.maxSlider),u=Math.floor(l.minSlider),p=l.maxSlider===l.minSlider;e.prices={symbolCurrency:a,maxSel:c,minSel:d,maxSlider:h,minSlider:u,isDisabled:p},e.pricesModel.set(e.prices)}var f=r.facets;if(f){var g=oe.getFacetsData({isMobile:e.isMobile,sort:e.sortOptions,facets:f});t&&i&&(g=e.setHiddenValue({collection:t,dropdownCode:i,openedAccordionElementCode:s,fieldsToChange:g}),e.setOpenedDropdownCodes(i,s)),e.facetsModel.unset("fields"),e.facetsModel.set({fields:g,focusedElementId:e.focusedElementId}),o&&(e.filters=e.getFilters(e.sortOptions,f),e.filtersModel.set({filters:e.filters,prices:e.prices}))}})),!o&&this.updateUrl()},setHiddenValue:function(e){var t=this,i=e.collection,s=e.dropdownCode,o=e.fieldsToChange,r=e.openedAccordionElementCode,n=o.slice();if(n&&n.length)for(var l=i.models,a=function(e,i){var o=n[e];if(o.code===s)return l.forEach((function(e){o.values.forEach((function(i){if(t.isMobile){if(i.code===r){for(var s=0,o=i.values.length;s<o;s++){var l=i.values[s];l.code===e.get("code")&&(l.isHidden=e.get("isHidden"))}return n}}else i.code===e.get("code")&&(i.isHidden=e.get("isHidden"))}))})),{v:n}},c=0,d=n.length;c<d;c++){var h=a(c);if("object"===re(h))return h.v}return n},updateUrl:function(){if(window.history&&window.history.pushState){var e=this.params?this.params:"";window.history.pushState(null,null,"".concat(window.location.pathname).concat(e))}},setParams:function(e){var t=this;if(this.sortRequestParams={},this.facetsRequestParams={},e&&Object.keys(e).length&&e.constructor===Object){if(this.searchValues.q="",Object.keys(e).forEach((function(i){switch(i){case c.SORT_CODE:var s=e.sort.models,o=s[s.length-1].get("code");t.sortRequestParams.sort=o;break;case c.PRICE_VALUE_CODE:break;default:t.facetsRequestParams[i]=e[i].models.map((function(e){return e.get("code")}))}})),this.sortRequestParams.sort&&(this.searchValues.sort=this.sortRequestParams.sort),Object.keys(this.facetsRequestParams).length||this.userPrices?this.searchValues.q=":":delete this.searchValues.q,Object.keys(this.facetsRequestParams).length){var i="";Object.keys(this.facetsRequestParams).forEach((function(e){t.facetsRequestParams[e].forEach((function(t){i+=":".concat(e,":").concat(t)}))})),this.searchValues.q+=i}this.userPrices&&(this.searchValues.q+=":".concat(c.PRICE_VALUE_CODE,":[").concat(this.userPrices.minSel," TO ").concat(this.userPrices.maxSel,"]"))}else delete this.searchValues.sort,delete this.searchValues.q},sendGtmEventForSearchUpdate:function(e){for(var t="",i=0;i<e.length-1;i+=2)t=t?t+","+e[i]+":"+e[i+1]:t+e[i]+":"+e[i+1];TPS.trackingUtils.sendGtmEvent({eventCategory:"interaction",eventAction:"OnlineSearchEvent",searchKeywordRefinement:t||""})}});function de(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return he(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return he(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}var ue=Backbone.Model.extend({defaults:{},url:function(){return"".concat(window.location.pathname,"/results")},parse:function(e){return e.results.forEach((function(t,i){var s=t.variantOptions,o=s&&1===s.length&&!_.isEmpty(s[0]),r=o?s[0].rrpprice:"",n=o?s[0].savePrice:"";t.roundelAttributesData&&t.roundelAttributesData.length&&(t.badge=t.roundelAttributesData),$.extend(e.results[i],{priceData:{price:TPS.productUtils.getPriceData(t),rrpPrice:r,savePrice:n}})})),this.attributes&&!this.attributes.isFilter&&this.attributes.results&&(e.results=[].concat(de(this.attributes.results),de(e.results))),e}}),pe=(i("vxnP"),Backbone.View.extend({initialize:function(){this.listenTo(this.model,"sync",this.render)},template:_.template("\n        {{= TPS.messages['redesign.text.result']\n            .replace('{0}', results.length)\n            .replace('{1}', pagination.totalNumberOfResults)\n        }}\n    "),render:function(){var e=this.model.toJSON();e&&e.results&&e.results.length&&e.pagination&&e.pagination.totalNumberOfResults?this.$el.html(this.template(e)):TPS.pageData.hideResultsForBundles||this.$el.html(TPS.messages["redesign.message.no.results.found"])}})),fe=i("jDpW"),ge=i("8Qz1"),me=i("SspL"),be=i("GTHP"),ve=Backbone.View.extend({tagName:"li",className:"product_grid__item",initialize:function(e){this.miniBasketPopup=null,this.id=e.id,this.product=e.product},render:function(){return this.$el.append(this.template({product:this.product,id:this.id})),this},events:{"click .j-bundle_tile":"onBundleClick"},template:_.template('<div id="{{=id}}" data-code="{{=product.productsOfBundle}}" class="item product_tile product_tile-bundle j-bundle_tile">\n            <a class="product_tile__link">\n                {{ if (product.primaryImageUrl) { }}\n                    <figure class="product_tile__figure">\n                        <img class="product_tile__image lazyload"\n                             data-src="{{=product.primaryImageUrl}}"\n                             src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="\n                             alt="{{=product.name}}"\n                             title="{{=product.name}}"/>\n                    </figure>\n                {{ } else { }}\n                    <figure class="product_tile__figure">\n                        <img class="product_tile__image lazyload"\n                             data-src="/_ui/redesign/theme-igc/img/missing-product-172x172.jpg"\n                             src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="\n                             alt="{{=product.name}}"\n                             title="{{=product.name}}"/>\n                    </figure>\n                {{ } }}\n                <div class="product_tile__info">\n                    <h3 itemprop="brand" class="product_tile__brand">\n                        {{= product.description }}\n                    </h3>\n                    <p class="product_tile__price">\n                        {{= product.price.formattedValue }}\n                    </p>\n                </div>\n            </a>\n            <button type="button" class="btn-black product_tile__btn j-bundle_buy">\n                {{= TPS.messages["redesign.product.bundle.add.to.bag"] }}\n            </button>\n        </div>'),onBundleClick:function(e){var t=this,i=e.target.closest(".j-bundle_tile").dataset.code.split(",").map((function(e){return e.trim()}));Object(ge.c)(i.join(","),i.map((function(){return 1})).join(",")).then((function(){ge.h.trigger("addToBagSuccess")})).catch((function(i){i.conflictProducts?me.a.resolve(i.conflictProducts,t.onBundleClick.bind(t,e)):(be.a.trigger("addToBagFailed"),be.a.set("error",i.message))}))}}),we=i("uycX"),_e=Backbone.View.extend({defaultPageSize:36,initialize:function(e){this.props=e||{},this.loadMoreButton=this.$(".j-load_more"),this.productList=this.$(".j-product_list"),this.showSpinner(),sessionStorage.savedGridPage?this.getData(0,(Number(sessionStorage.savedGridPage)+1)*this.defaultPageSize):this.getData(),this.listenTo(this.model,"request",this.showSpinner),this.listenTo(this.model,"sync error",this.hideSpinner),this.listenTo(this.model,"sync",this.render)},events:{"click .product_grid__item":"saveScrollPosition","click .j-load_more":"handleLoadMoreClick"},saveScrollPosition:function(e){sessionStorage.setItem("savedGridPage",this.loadMoreButton.data("page")),sessionStorage.setItem("scrollTop",e.currentTarget.offsetTop)},handleLoadMoreClick:function(){var e=Number(this.loadMoreButton.data("page"))+1;this.loadMoreButton.data("page",e),this.getData(e)},getData:function(e,t){var i=TPS.utils.facetSearchQueryToObj(window.location.search);"number"==typeof e&&(i=Object.assign({},i,{page:e})),t&&(i=Object.assign({},i,{resultsForPage:t}));var s="";Object.keys(i).forEach((function(e){s+="".concat(e,"=").concat(encodeURIComponent(i[e]),"&")})),this.model.fetch({data:s.slice(0,-1)})},showSpinner:function(){TPS.utils.addSpinner(this.$el)},hideSpinner:function(){TPS.utils.removeSpinner(this.$el)},render:function(){var e=this;this.productList.empty();var t=this.model.get("results");t&&t.forEach((function(t,i){var s,o=e.props,r=o.isGWP,n=o.isSkuGWP;s=t.bundle?new ve({id:i,product:t}).render():new we.a({product:t,id:i,isGWP:r,isSkuGWP:n}).render(),e.$(".j-product_list").append(s.$el)}),this),sessionStorage.scrollTop&&(TPS.scroller.scrollTo(sessionStorage.scrollTop),sessionStorage.removeItem("scrollTop")),sessionStorage.savedGridPage&&(this.model.set("pagination",Object.assign(this.model.get("pagination"),{pageSize:this.defaultPageSize,currentPage:Number(sessionStorage.savedGridPage)})),this.model.trigger("updateCurrentPage"),sessionStorage.removeItem("savedGridPage"))}}),ye=Backbone.View.extend({elements:{$categoryLinksToggler:$(".js-mobile__category_header_toggle"),$overlay:$(".j-overlay"),$categoryLinks:$(".j-category_links"),$categoryLinksList:$(".j-category_links__list"),$categoryLinksItem:$(".category_links__item")},initialize:function(){this.isNext=!!this.elements.$categoryLinksToggler.next().hasClass(".j-category_links"),this.isNext||(this.prevEl=this.elements.$categoryLinks.prev()),window.addEventListener("resize",this.checkResolution.bind(this)),this.checkResolution()},checkResolution:function(){window.matchMedia("(max-width: 991px)").matches?(this.isNext||this.elements.$categoryLinksToggler.after(this.elements.$categoryLinks),this.removeListeners(),this.initMobileListeners()):(this.removeListeners(),this.resetLinks(),this.isNext||this.prevEl.after(this.elements.$categoryLinks))},initMobileListeners:function(){var e=this;this.elements.$categoryLinksToggler.on("click",(function(){e.elements.$categoryLinksToggler.toggleClass("open"),e.elements.$overlay.toggleClass("overlay-mobile_category_open")})),this.elements.$overlay.on("click",(function(){e.elements.$categoryLinksToggler.removeClass("open"),e.elements.$overlay.removeClass("overlay-mobile_category_open")}))},removeListeners:function(){this.elements.$categoryLinksToggler.off("click"),this.elements.$overlay.off("click")},resetLinks:function(){this.elements.$categoryLinksToggler.removeClass("open"),this.elements.$overlay.removeClass("overlay-mobile_category_open")}}),Se=(i("rs7l"),i("irg0"),Backbone.View.extend({initialize:function(e){this.productAmountElement=this.$(e.productAmountClassName)||null,this.productAmount=+this.productAmountElement.text(),this.initTabs(),this.productAmountElement&&this.listenTo(this.model,"change:pagination",this.updateProductAmount)},initTabs:function(){var e=this,t=[],i=0;TPS.searchPageNumberOfResults||(t.push(0),i=1),TPS.contentHubArticleNumberOfResults||(t.push(1),i=0);var s={disabled:t,active:i,create:function(){e.removeLoading()},activate:function(){$(".j-product_grid__article_paragraph").clamp({lines:4})}};this.$el.tabs(s)},removeLoading:function(){this.$el.removeClass("tabs-loaded"),TPS.utils.removeSpinner(this.$el,!0)},updateProductAmount:function(){var e=this.model.get("pagination")&&this.model.get("pagination").totalNumberOfResults;this.productAmountElement&&this.productAmount!==e&&(this.productAmountElement.text("".concat(TPS.messages["search.tab.products.label"]," (").concat(e,")")),this.productAmount=e)}}));function Me(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function Ce(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Pe=!1;function Oe(e){var t=new ue,i=e&&e.isSearchPage;TPS.pageData&&TPS.pageData.facets&&TPS.pageData.facets.length&&!TPS.pageData.isFacetsInitialized&&new ce({el:"section.facets",sorts:TPS.pageData.sorts,facets:TPS.pageData.facets,prices:TPS.pageData.prices,model:t,isMobile:Pe}).render(),new pe({el:".j-products_count",model:t}),new _e(function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(i),!0).forEach((function(t){Ce(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Me(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({el:".j-product_grid",model:t},e)),new fe.a({el:".j-load_more",model:t}),$(".six_tiles").addClass("six_tiles-plp");var o=TPS.config,r=$(".j-category_accordion"),n=$(".j-mobile_category_menu"),l=r.data("isabrand"),a={collapsible:!0,active:!!l&&0,heightStyle:"content",icons:!1,classes:{"ui-accordion":"category_menu","ui-accordion-header":"category_menu__item_header","ui-accordion-header-collapsed":"category_menu__item_header-collapsed","ui-accordion-content":"category_menu__item_content","ui-accordion-content-active":"category_menu__item_content-active"}},c={collapsible:!0,active:!1,heightStyle:"content",icons:!1,classes:{"ui-accordion":"mobile_category_menu","ui-accordion-header":"mobile_category_menu__header","ui-accordion-header-collapsed":"mobile_category_menu__header-collapsed","ui-accordion-content":"mobile_category_menu__content"}};function d(){n.accordion(c)}function h(){n.accordion("instance")&&n.accordion("destroy")}if(l?r.accordion({collapsible:!0,active:!1,heightStyle:"content",icons:!1,classes:{"ui-accordion":"mobile_category_menu","ui-accordion-header-collapsed":"mobile_category_menu__header-collapsed","ui-accordion-content":"mobile_category_menu__content"},beforeActivate:function(e,t){var i,s;s=t.newHeader[0]?(i=t.newHeader).next(".ui-accordion-content"):(i=t.oldHeader).next(".ui-accordion-content");var o="true"==i.attr("aria-selected");return i.toggleClass("ui-corner-all",o).toggleClass("accordion-header-active ui-state-active ui-corner-top",!o).attr("aria-selected",(!o).toString()),s.toggleClass("accordion-content-active",!o),o?s.slideUp():s.slideDown(),!1}}):r.accordion(a),enquire.register(o.breakpoints.mobile,{match:d}).register(o.breakpoints.largemobile,{match:d}).register(o.breakpoints.smalltablet,{match:d}).register(o.breakpoints.tablet,{match:h}).register(o.breakpoints.desktop,{match:h}).register(o.breakpoints.wide,{match:h},!0),new s.a({model:new Backbone.Model,settings:{selector:".j-peerius_carousel",autoPlay:!1,rewindNav:!1,navigation:!0,pagination:!1,singleItem:1,items:3,itemsCustom:!1,itemsDesktop:[1199,3],itemsDesktopSmall:[991,2],itemsTablet:!1,itemsTabletSmall:!1,itemsMobile:[767,1]}}).render(),$(".j-category_links").length&&new ye,i){var u=$(".j-search_tabs");u.length&&new Se({el:u,productAmountClassName:".j-search_tabs__product_amount",model:t})}}enquire.register(TPS.config.mobileBreakpoint,{match:function(){Pe=!0},unmatch:function(){Pe=!1}})},SspL:function(e,t,i){"use strict";i("p532"),i("4mDm"),i("3bBZ"),i("FZtP"),i("vxnP");var s=i("8Qz1");function o(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var r="REMOVAL",n="CHECKOUT",l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,l,c;return t=e,c=[{key:"resolve",value:function(e,t){var o=a(s.h);return function(e){for(var t=[],o=0,l=Object.values(e);o<l.length;o++){var a=l[o];t=t.concat(a)}var c=function(e){var t=s.h.get("entries").getAllEntries(),i=[];return t.forEach((function(t){var s=t.get("product").code;e.includes(s)&&i.push(t.toJSON())})),i}(t);return new Promise((function(e){i.e(114).then(i.bind(null,"dMgy")).then((function(t){new(0,t.default)({alertMessage:TPS.messages["onestock.sorry.popup.conflicting.products"],products:c,buttons:{remove:{onClick:function(t){var i=function(e){var t=e.filter((function(e){return!e.engraving&&!e.giftWrap&&!e.gwpEntry})).map((function(e){return e.product.code}));return s.h.silentEntriesUpdate=!0,Object(s.y)(t).catch((function(){throw new Error(TPS.messages["onestock.remove.conflict.products.error"])})).finally((function(){s.h.silentEntriesUpdate=!1}))}(t);return i.then((function(){e(r)})),i}},cta:{onClick:function(){return window.location=TPS.pages.CHECKOUT,e(n),!1}}}}).open()}))}))}(e).then((function(e){if(e===r)return t().then((function(e){var t,i,r,n=a(s.h);return o.length&&!n.length?(t=o,i=t.map((function(e){return e.code})).join(","),r=new Array(t.length).fill(1).join(","),Object(s.c)(i,r)).catch((function(e){console.error("An error has occurred while restoring donations: ",e)})).finally((function(){return e})):e}))})).catch((function(e){console.error("An error has occurred while resolving conflict products: ",e)}))}}],(l=null)&&o(t.prototype,l),c&&o(t,c),e}();function a(e){return e.get("charityProductData").filter((function(e){return!!e.entryNumber}))}t.a=l},irg0:function(e,t,i){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i("rB9j"),i("UxlC"),i("SYor"),i("4Brf"),i("4mDm"),i("3bBZ"),function(e,t,i){var o,r,n,l,a,c,d,h,u,p,f={},g=i.createElement.bind(i),m=i.createTextNode.bind(i);o=g("span"),(p=o.style).position="absolute",p.whiteSpace="pre",p.visibility="hidden",f.init=function(t){var s=t.lines;this.each((function(){var t=this;t.ownerDocument&&!t.ownerDocument!==i&&(l=c=0,a=1,u=!1,n=t.clientWidth,r=e(this).text().trim().replace(/\n/g," "),e(this).empty(),t.appendChild(o),r.replace(/ /g,(function(e,i){a!==s&&(o.appendChild(m(r.substr(l,i-l))),n<o.clientWidth?(u?(h=r.substr(l,i+1-l),l=i+1):(h=r.substr(l,c-l),l=c),(d=g("span")).appendChild(m(h)),t.appendChild(d),u=!0,a++):u=!1,c=i+1,o.removeChild(o.firstChild))})),t.removeChild(o),function(e){e.display="inline-block",e.overflow="hidden",e.textOverflow="ellipsis",e.whiteSpace="nowrap",e.width="100%"}((d=g("span")).style),d.appendChild(m(r.substr(l))),t.appendChild(d))}))},e.fn.clamp=function(t){return f[t]?f[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==s(t)&&t?void e.error("Method "+t+" does not exist on jquery.clamp"):f.init.apply(this,arguments)}}(jQuery,window,document)},jDpW:function(e,t,i){"use strict";i("vxnP"),i("rB9j"),i("UxlC");var s=Backbone.View.extend({defaultPageNumber:0,initialize:function(e){this.text=e.text,this.listenTo(this.model,"sync",this.render),this.listenTo(this.model,"updateCurrentPage",this.updatePageNumber),this.listenTo(this.model,"change:isFilter",this.resetData)},render:function(){var e=this.model.toJSON().pagination,t=(this.text||TPS.messages["redesign.loadMore"]).replace("{0}",e.pageSize),i='<button class="btn btn-black" aria-label="'.concat(t,'">\n                ').concat(t,"\n            </button>");this.$el.empty().append(i);var s=Number(this.$el.data("page")),o="number"!=typeof s||isNaN(s)?this.defaultPageNumber:s+1;s>=e.numberOfPages||o===e.numberOfPages?this.$el.hide():this.$el.show().find(".btn").blur()},resetData:function(){this.$el.data("page",this.defaultPageNumber)},updatePageNumber:function(){this.$el.data("page",this.model.get("pagination").currentPage)}});t.a=s},uycX:function(e,t,i){"use strict";i("FZtP");var s=i("CS/8"),o=Backbone.View.extend({tagName:"li",className:"product_grid__item",defaultFigure:"",defaultPromo:"",defaultPrice:"",defaultTags:"",defaultCard:"",defaultBtn:"",defaultStars:"",initialize:function(e){this.id=e.id,this.product=e.product,this.isSkuGWP=e.isSkuGWP||!1,this.isGWP=e.isGWP||!1},render:function(){if(!this.product)return this;var e=this.getFigure(),t=this.getPromo(),i=this.getTags(),o=this.getCard(),r=this.getBtn(),n=this.getStars(),l='\n            <div id="product_grid__item-'.concat(this.id,'" class="item product_tile j-product_tile">\n                <a href="').concat(this.getProductUrl(),'" class="product_tile__link">\n                    ').concat(e,'\n                    <div class="product_tile__info">\n                        ').concat(this.product.egiftCard?"":"".concat(t).concat(i),"\n                        \n                        ").concat(o,"\n                        ").concat(n,"\n\n                    </div>\n                </a>\n                ").concat(r,"\n            </div>");return this.$el.append(l),new s.a({el:this.$(".j-star_rating")}),this},getProductUrl:function(){return TPS.utils.getInternationalUrl(this.product.gwpQualifyingProductsUrl?this.product.gwpQualifyingProductsUrl:this.product.url)},getFigure:function(){var e=this.defaultFigure,t=TPS.productImageUtils.findSomeFormatImage(this.product.images,"prodcat");if(t){var i=this.product.igcBrandName+" "+this.product.rangeName+" "+this.product.name+" "+(this.product.variantOptions?this.product.variantOptions[0].igcContentSizeUnit:"");e='<figure class="product_tile__figure">\n                <img class="product_tile__image Product_image lazyload"\n                    data-src="'.concat(t.symbolicUrl,'"\n                    src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="\n                    alt="').concat(i,'"\n                    title="').concat(t.symbolicAltText,'"\n                />\n            </figure>')}else e='<figure class="product_tile__figure">\n                <img class="product_tile__image lazyload"\n                     data-src="/_ui/redesign/theme-igc/img/missing-product-172x172.jpg"\n                     src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="\n                     alt="'.concat(this.product.name,'"\n                     title="').concat(this.product.name,'"/>\n            </figure>');return e},getPromo:function(){var e=this.defaultPromo;if(!this.product.brandData.excludeDisplayPromotions){var t="",i="";this.product.promoBadge1Url&&(t=this.getPromoTemplate(this.product.promoBadge1Url)),this.product.promoBadge2Url&&(i=this.getPromoTemplate(this.product.promoBadge2Url)),(t||i)&&(e='<div class="product_tile__badges">'.concat(t).concat(i,"</div>"))}return e},getPromoTemplate:function(e){return'<img src="'.concat(e,'" class="product_tile__badge lazyload">')},getPrice:function(){var e=this.defaultPrice;this.product.priceData&&this.product.priceData.price&&(e="".concat(TPS.formatUtils.formatPrice(this.product.priceData.price)),this.product.tpsMaxProductPrice&&this.product.priceData&&this.product.priceData.price&&this.product.priceData.price.value!==this.product.tpsMaxProductPrice.value?e+=" - ".concat(TPS.formatUtils.formatPrice(this.product.tpsMaxProductPrice)):e=this.product.priceData.savePrice?'\n                    <span class="product_tile__price_only">\n                        '.concat(TPS.messages["redesign.product.price.only"],"\n                        ").concat(e,'\n                    </span>\n                    <span class="product_tile__price_rrp">\n                        ').concat(TPS.messages["redesign.product.price.rrp"],"\n                        ").concat(TPS.formatUtils.formatPrice(this.product.priceData.rrpPrice),'\n                    </span>\n                    <span class="product_tile__price_sale">\n                         ').concat(TPS.messages["redesign.product.price.save"],'\n                         <span class="product_tile__price_text">').concat(TPS.formatUtils.formatPrice(this.product.priceData.savePrice),"</span>\n                    </span>\n                "):"".concat(TPS.formatUtils.formatPrice(this.product.priceData.price)));return'<p class="product_tile__price">'.concat(e,"</p>")},getTags:function(){var e=this.defaultTags;return this.product.badge&&this.product.badge.forEach((function(t){e+='<span class="product_tile__tag">'.concat(t.label,"</span>")})),'<div class="product_tile__tags">'.concat(e,"</div>")},getCard:function(){var e=this.defaultCard,t=this.getPrice();if(this.product.gwpQualifyingProductsUrl){var i=this.isGWP?"product_tile__title-spacing":"",s=this.isGWP?"":"product_tile__offer";e='\n                <p class="product_tile__brand j-brand_page_link"\n                    data-url="'.concat(this.product.brandUrl,'"\n                >').concat(this.product.brandData.name||this.product.igcBrandName,'</p>\n                <p itemprop="name" class="product_tile__title ').concat(i,'">').concat(this.product.rangeName,"</p>\n                ").concat(this.isSkuGWP?'<p itemprop="description" class="product_tile__description">'.concat(this.product.name,"</p>"):"",'\n                <button class="btn btn-black product_tile__offer w-100 ').concat(s,'">').concat(TPS.messages["redesign.shopThisOffer"],"</button>")}else{var o=this.product.variantOptions&&this.product.variantOptions[0].igcVariantOptionQualifiers.variantSize,r="".concat(this.product.name," ").concat(o?"- ".concat(this.product.variantOptions[0].igcVariantOptionQualifiers.variantSize):"");e='\n                <p class="product_tile__brand">'.concat(this.product.brandData.name||this.product.igcBrandName,'</p>\n                <p class="product_tile__title">').concat(this.product.rangeName,'</p>\n                <p class="product_tile__description">').concat(r,"</p>\n                ").concat(this.product.egiftCard?"":"".concat(t),"\n            ")}return e},getBtn:function(){var e=this.defaultBtn,t=TPS.utils.addStringToUrl(this.product.url,"/quickView");if(!this.product.egiftCard&&!this.product.gwpQualifyingProductsUrl)if(!this.product.price||!JSON.parse(TPS.config.isBackInStockNotificationEnabled)&&"outOfStock"===this.product.stock.stockLevelStatus.code)e='<button type="button" class="btn-black product_tile__btn disabled j-quick_buy"\n                    tabindex="-1"\n                    data-url="'.concat(TPS.utils.getInternationalUrl(t),'">\n                    ').concat(TPS.messages["product.not.purchasable.message"],"\n                </button>");else if(JSON.parse(TPS.config.isBackInStockNotificationEnabled)&&this.product.price&&"outOfStock"===this.product.stock.stockLevelStatus.code){var i=TPS.configurationManager.oneStockEnabled?TPS.messages["onestock.product.out.of.stock"]:TPS.messages["product.out.of.stock"];e='<button type="button" class="btn-black product_tile__btn j-quick_buy"\n                        tabindex="-1"\n                        data-url="'.concat(TPS.utils.getInternationalUrl(t),'">\n                        ').concat(i,"\n                    </button>")}else e='<button type="button" class="btn-black product_tile__btn j-quick_buy"\n                    tabindex="-1"\n                    data-url="'.concat(TPS.utils.getInternationalUrl(t),'">\n                    ').concat(TPS.messages["redesign.product.quick.buy.message"],"\n                </button>");return e},getStars:function(){var e=this.defaultStars;return TPS.configurationManager.activeReviewForBu&&!this.isGWP&&this.product.averageRating&&(e='\n                <div class="product_tile__stars">\n                    <div class="j-star_rating" data-rating="'.concat(this.product.averageRating,'"></div>\n                </div>\n            ')),e}});t.a=o}}]);